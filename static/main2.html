<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CosmoRudder - Professional SAR Solar System Monitoring for NASA Space Apps Challenge 2025">
    <meta name="keywords" content="SAR, synthetic aperture radar, solar system, Earth monitoring, NASA, Space Apps Challenge">
    <meta name="author" content="NASA Space Apps Challenge 2025 - CosmoRudder Team">
    <title>CosmoRudder - Solar System SAR Navigator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Roboto+Mono:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Orbitron', sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            margin: 0;
        }
        .radar-sweep {
            animation: sweep 4s ease-in-out infinite;
            transform-origin: center;
        }
        @keyframes sweep {
            0% { transform: rotate(0deg); opacity: 0.9; }
            50% { transform: rotate(180deg); opacity: 0.6; }
            100% { transform: rotate(360deg); opacity: 0.9; }
        }
        .orbital-pulse {
            animation: orbitalPulse 3s ease-in-out infinite;
        }
        @keyframes orbitalPulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 0.6; }
        }
        .radar-pulse {
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 0.9; }
        }
        .hologram {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(0, 255, 0, 0.1));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.15);
        }
        .neon-text {
            text-shadow: 0 0 10px currentColor, 0 0 20px rgba(0, 255, 255, 0.5);
        }
        .hologram-panel {
            background: linear-gradient(135deg, rgba(0, 20, 40, 0.95), rgba(0, 40, 80, 0.9));
            backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 255, 127, 0.3);
            box-shadow: 0 8px 32px rgba(0, 255, 127, 0.1);
        }
        .neon-glow {
            text-shadow: 0 0 10px currentColor, 0 0 20px rgba(0, 255, 127, 0.5), 0 0 30px rgba(0, 255, 127, 0.3);
        }
        .sar-beam {
            background: linear-gradient(90deg, transparent, rgba(0, 255, 127, 0.8), transparent);
            animation: beamSweep 3s linear infinite;
        }
        @keyframes beamSweep {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .frequency-indicator {
            background: linear-gradient(90deg, #ff0040, #ff8000, #ffff00, #00ff80, #0080ff, #8000ff);
            background-size: 200%;
            animation: frequencySweep 5s linear infinite;
        }
        @keyframes frequencySweep {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }
        .mission-status {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 127, 0.4);
            backdrop-filter: blur(10px);
        }
        .data-stream {
            font-family: 'Roboto Mono', monospace;
            color: #00ff7f;
            opacity: 0.8;
            font-size: 10px;
            line-height: 1.2;
            white-space: pre;
        }
        .earth-mode {
            border: 2px solid #00ff7f;
            box-shadow: 0 0 20px rgba(0, 255, 127, 0.5);
        }
        .planet-button {
            transition: all 0.3s ease;
        }
        .planet-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0, 255, 127, 0.6);
        }
    </style>
</head>
<body>
    <!-- Navigation Header -->
    <nav class="fixed top-0 left-0 right-0 z-50 mission-status px-6 py-3">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div onclick="location.href='main.html'"  class="cursor-pointer flex items-center">
                    <span class="material-icons text-green-400 mr-3 text-4xl radar-sweep">radar</span>
                    <div>
                        <h1 class="text-2xl font-bold neon-glow text-green-400">COSMORUDDER</h1>
                        <p class="text-xs text-blue-300">Solar System SAR Navigator | NASA Space Apps Challenge 2025</p>
                    </div>
                </div>
            </div>
            <div class="flex items-center space-x-8">
                <div class="text-xs font-mono">
                    <div class="text-gray-300">Mode:</div>
                    <div id="system-mode" class="text-cyan-400 font-bold">SOLAR SYSTEM</div>
                </div>
                <div class="text-xs font-mono">
                    <div class="text-gray-300">Active Planet:</div>
                    <div id="active-planet" class="text-yellow-400 font-bold">ALL SYSTEMS</div>
                </div>
                <div class="text-xs font-mono">
                    <div class="text-gray-300">SAR Status:</div>
                    <div id="sar-status" class="text-red-400 font-bold">STANDBY</div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main 3D Scene -->
    <div id="scene-container" class="w-full h-screen relative"></div>

    <!-- Left Solar System Controls -->
    <div class="fixed left-4 top-20 hologram-panel rounded-lg p-4 w-80 max-h-[calc(100vh-160px)] overflow-y-auto">
        <div class="flex items-center mb-4">
            <span class="material-icons text-cyan-400 mr-3 text-2xl">public</span>
            <h3 class="text-lg font-bold neon-glow text-cyan-400">System Navigation</h3>
        </div>
        
        <!-- Orbital Controls -->
        <div class="mb-6">
            <label class="text-sm text-green-400 font-medium block mb-3">Orbital Mechanics:</label>
            <div class="space-y-3">
                <div>
                    <div class="flex justify-between items-center mb-1">
                        <label class="text-xs text-blue-300">Revolution Speed:</label>
                        <span id="rev-speed-val" class="text-xs text-white">1.0x</span>
                    </div>
                    <input type="range" id="revolution-speed" min="0.1" max="5.0" step="0.1" value="1.0" 
                           class="w-full accent-cyan-400 cursor-pointer">
                </div>
                <div>
                    <div class="flex justify-between items-center mb-1">
                        <label class="text-xs text-blue-300">Rotation Speed:</label>
                        <span id="rot-speed-val" class="text-xs text-white">1.0x</span>
                    </div>
                    <input type="range" id="rotation-speed" min="0.1" max="10.0" step="0.1" value="1.0" 
                           class="w-full accent-green-400 cursor-pointer">
                </div>
            </div>
        </div>

        <!-- Planet Quick Select -->
        <div class="mb-6">
            <label class="text-sm text-green-400 font-medium block mb-3">Quick Planet Access:</label>
            <div class="grid grid-cols-2 gap-2">
                <button class="planet-button bg-gray-600 hover:bg-gray-700 px-3 py-2 rounded text-xs transition-colors" onclick="focusPlanet('Mercury')">‚òø Mercury</button>
                <button class="planet-button bg-yellow-600 hover:bg-yellow-700 px-3 py-2 rounded text-xs transition-colors" onclick="focusPlanet('Venus')">‚ôÄ Venus</button>
                <button class="planet-button bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded text-xs transition-colors" onclick="focusPlanet('Earth')">üåç Earth</button>
                <button class="planet-button bg-red-600 hover:bg-red-700 px-3 py-2 rounded text-xs transition-colors" onclick="focusPlanet('Mars')">‚ôÇ Mars</button>
                <button class="planet-button bg-orange-600 hover:bg-orange-700 px-3 py-2 rounded text-xs transition-colors" onclick="focusPlanet('Jupiter')">‚ôÉ Jupiter</button>
                <button class="planet-button bg-yellow-700 hover:bg-yellow-800 px-3 py-2 rounded text-xs transition-colors" onclick="focusPlanet('Saturn')">‚ôÑ Saturn</button>
                <button class="planet-button bg-cyan-600 hover:bg-cyan-700 px-3 py-2 rounded text-xs transition-colors" onclick="focusPlanet('Uranus')">‚ôÖ Uranus</button>
                <button class="planet-button bg-blue-800 hover:bg-blue-900 px-3 py-2 rounded text-xs transition-colors" onclick="focusPlanet('Neptune')">‚ôÜ Neptune</button>
            </div>
        </div>

        <!-- View Controls -->
        <div class="border-t border-gray-600 pt-4">
            <div class="grid grid-cols-2 gap-2 mb-3">
                <button id="reset-view" class="bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded text-xs transition-colors">
                    <span class="material-icons text-sm mr-1">refresh</span>RESET
                </button>
                <button id="toggle-orbits" class="bg-purple-600 hover:bg-purple-700 px-3 py-2 rounded text-xs transition-colors">
                    <span class="material-icons text-sm mr-1">track_changes</span>ORBITS
                </button>
            </div>
            <button id="pause-animation" class="w-full bg-orange-600 hover:bg-orange-700 px-4 py-3 rounded font-medium transition-colors">
                <span class="material-icons text-base mr-2">pause</span>PAUSE SYSTEM
            </button>
        </div>
    </div>

    <!-- Right SAR Analysis Panel -->
    <div id="sar-panel" class="fixed right-4 top-20 hologram-panel rounded-lg p-4 w-96 max-h-[calc(100vh-160px)] overflow-y-auto hidden">
        <div class="flex items-center mb-4">
            <span class="material-icons text-green-400 mr-3 text-2xl radar-sweep">settings_input_antenna</span>
            <h3 class="text-lg font-bold neon-glow text-green-400">SAR Analysis</h3>
        </div>
        
        <!-- SAR Configuration -->
        <div class="mb-6">
            <label class="text-sm text-cyan-400 font-medium block mb-3">Radar Configuration:</label>
            <div class="space-y-2">
                <select id="frequency-band" class="w-full bg-gray-900 border border-cyan-400 rounded px-3 py-2 text-sm text-white">
                    <option value="L">L-Band (1-2 GHz) - Deep Penetration</option>
                    <option value="S">S-Band (2-4 GHz) - Agriculture/Ice</option>
                    <option value="C" selected>C-Band (4-8 GHz) - Ocean/Urban</option>
                    <option value="X">X-Band (8-12 GHz) - High Resolution</option>
                </select>
                <div class="grid grid-cols-4 gap-1 mt-2">
                    <button class="pol-btn bg-purple-600 px-2 py-1 rounded text-xs" data-pol="VV">VV</button>
                    <button class="pol-btn bg-blue-600 px-2 py-1 rounded text-xs" data-pol="HH">HH</button>
                    <button class="pol-btn bg-green-600 px-2 py-1 rounded text-xs active" data-pol="VH">VH</button>
                    <button class="pol-btn bg-orange-600 px-2 py-1 rounded text-xs" data-pol="HV">HV</button>
                </div>
            </div>
        </div>

        <!-- Earth Process Analysis (only visible for Earth) -->
        <div id="earth-processes" class="mb-6 hidden">
            <label class="text-sm text-cyan-400 font-medium block mb-3">Earth Process Targets:</label>
            <div class="space-y-2">
                <button class="w-full bg-gradient-to-r from-green-600 to-blue-600 hover:opacity-80 px-3 py-2 rounded text-xs transition-opacity" onclick="analyzeProcess('forest')">
                    üå≤ Forest Dynamics
                </button>
                <button class="w-full bg-gradient-to-r from-blue-600 to-cyan-600 hover:opacity-80 px-3 py-2 rounded text-xs transition-opacity" onclick="analyzeProcess('flood')">
                    üåä Flood Mapping
                </button>
                <button class="w-full bg-gradient-to-r from-red-600 to-orange-600 hover:opacity-80 px-3 py-2 rounded text-xs transition-opacity" onclick="analyzeProcess('volcano')">
                    üåã Volcanic Activity
                </button>
                <button class="w-full bg-gradient-to-r from-cyan-600 to-white hover:opacity-80 px-3 py-2 rounded text-xs transition-opacity text-gray-900" onclick="analyzeProcess('ice')">
                    ‚ùÑÔ∏è Ice Dynamics
                </button>
            </div>
        </div>

        <!-- SAR Data Display -->
        <div class="mb-6">
            <h4 class="text-sm text-green-400 font-medium mb-2">SAR Signature:</h4>
            <div class="bg-black bg-opacity-50 p-3 rounded border-l-3 border-green-400">
                <div class="data-stream" id="sar-data">
SYSTEM STANDBY
Click on a planet to activate
SAR analysis capabilities

Available targets:
- Earth: Advanced process analysis
- Venus: Atmospheric penetration
- Mars: Subsurface mapping
- Europa: Ice shell analysis
                </div>
            </div>
        </div>

        <!-- Temporal Chart -->
        <div class="mb-4">
            <h4 class="text-sm text-cyan-400 font-medium mb-2">Temporal Analysis:</h4>
            <canvas id="temporal-chart" width="300" height="120" style="height: 120px; max-height: 120px;"></canvas>

        </div>

        <!-- SAR Controls -->
        <div class="border-t border-gray-600 pt-4">
            <button id="sar-scan" class="w-full bg-green-600 hover:bg-green-700 px-4 py-3 rounded font-medium transition-colors mb-2">
                <span class="material-icons text-base mr-2">play_arrow</span>
                INITIATE SAR SCAN
            </button>
            <button id="hypothesis-mode" class="w-full bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded text-sm transition-colors">
                <span class="material-icons text-sm mr-1">psychology</span>
                GENERATE HYPOTHESIS
            </button>
        </div>
    </div>

    <!-- Planet Info Panel -->
    <div id="planet-info" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 hologram-panel rounded-lg p-6 w-[500px] hidden z-50">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center">
                <span id="planet-icon" class="material-icons text-yellow-400 mr-3 text-3xl orbital-pulse">public</span>
                <h3 id="planet-name" class="text-xl font-bold neon-glow text-yellow-400"></h3>
            </div>
            <button id="close-planet-info" class="text-gray-400 hover:text-white transition-colors">
                <span class="material-icons">close</span>
            </button>
        </div>
        
        <div id="planet-details" class="space-y-4 text-sm">
            <!-- Planet details will be populated here -->
        </div>
        
        <div class="flex space-x-3 mt-6">
            <button id="activate-sar" class="flex-1 bg-green-600 hover:bg-green-700 px-4 py-2 rounded transition-colors">
                <span class="material-icons text-sm mr-1">radar</span>
                Activate SAR
            </button>
            <button class="flex-1 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded transition-colors" onclick="focusPlanetCamera()">
                <span class="material-icons text-sm mr-1">center_focus_weak</span>
                Focus View
            </button>
        </div>
    </div>

    <!-- Hypothesis Panel -->
    <div id="hypothesis-panel" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 hologram-panel rounded-lg p-4 w-[700px] hidden">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center">
                <span class="material-icons text-pink-400 mr-3 text-2xl">psychology</span>
                <h3 class="text-lg font-bold neon-glow text-pink-400">Scientific Hypothesis Generator</h3>
            </div>
            <button id="close-hypothesis" class="text-gray-400 hover:text-white transition-colors">
                <span class="material-icons">close</span>
            </button>
        </div>
        <div id="hypothesis-content" class="text-sm text-gray-300">
            <!-- Hypothesis content will be generated here -->
        </div>
    </div>

    <!-- Bottom Status Bar -->
    <div class="fixed bottom-0 left-0 right-0 mission-status px-6 py-3">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-8">
                <div class="flex items-center">
                    <div id="system-indicator" class="w-3 h-3 bg-green-400 rounded-full mr-2 orbital-pulse"></div>
                    <span class="text-sm text-green-400 font-mono">COSMORUDDER OPERATIONAL</span>
                </div>
                <div class="text-xs font-mono">
                    <span class="text-gray-300">Orbital Speed: </span>
                    <span id="orbital-speed-display" class="text-cyan-400">1.0x</span>
                </div>
                <div class="text-xs font-mono">
                    <span class="text-gray-300">Active Satellites: </span>
                    <span class="text-green-400">12 Online</span>
                </div>
            </div>
            <div class="text-xs font-mono text-gray-300">
                CosmoRudder v4.0 | Solar System SAR Navigator | NASA Space Apps Challenge 2025
            </div>
        </div>
    </div>

    <script>
        // Three.js core components
        let scene, camera, renderer;
        let planets = [], sun, asteroids = [], orbits = [], sarBeams = [];
        let animationId, clock = new THREE.Clock();
        let revolutionSpeed = 1.0, rotationSpeed = 1.0;
        let isPaused = false, isScanning = false;
        let currentPlanet = null, sarChart;
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();

        // Enhanced planet data combining orbital mechanics with SAR capabilities
        const planetDatabase = {
    Mercury: {
        name: "Mercury", distance: 3, size: 0.15, color: 0xb0b0b0,
        texturePath: 'textures/mercury.jpg',
        revolutionPeriod: 88, rotationPeriod: 59,
        sarCapable: true,
        sarData: {
            description: "Extreme temperature variations create unique radar signatures. No atmosphere allows direct surface analysis.",
            frequency: "X-band optimal for high-resolution surface mapping",
            backscatter: { vv: -8.2, vh: -14.5, coherence: 0.95 },
            processes: ["Solar wind interaction", "Thermal cycling", "Impact cratering", "Volatile redistribution"]
        }
    },
    Venus: {
        name: "Venus", distance: 4, size: 0.25, color: 0xffd700,
        texturePath: 'textures/venus.jpg',
        revolutionPeriod: 225, rotationPeriod: -243,
        sarCapable: true,
        sarData: {
            description: "Dense CO‚ÇÇ atmosphere penetrated by L-band SAR reveals surface geology beneath clouds.",
            frequency: "L-band for atmospheric penetration, reveals hidden surface features",
            backscatter: { vv: -12.8, vh: -18.3, coherence: 0.72 },
            processes: ["Volcanic resurfacing", "Atmospheric super-rotation", "Greenhouse effect", "Tessera formation"]
        }
    },
    Earth: {
        name: "Earth", distance: 5, size: 0.3, color: 0x00b7eb,
        texturePath: 'textures/earth.jpg',
        revolutionPeriod: 365.25, rotationPeriod: 1,
        sarCapable: true, earthProcesses: true,
        sarData: {
            description: "Advanced multi-frequency SAR reveals complex Earth system processes and surface changes.",
            frequency: "Multi-band analysis: L, S, C, X for comprehensive Earth observation",
            backscatter: { vv: -11.5, vh: -17.2, coherence: 0.85 },
            processes: ["Hydrological cycle", "Tectonic activity", "Ecosystem dynamics", "Climate system interactions"]
        }
    },
    Mars: {
        name: "Mars", distance: 6.5, size: 0.2, color: 0xd2691e,
        texturePath: 'textures/mars.jpg',
        revolutionPeriod: 687, rotationPeriod: 1.03,
        sarCapable: true,
        sarData: {
            description: "Subsurface ice detection and ancient water flow analysis through radar penetration.",
            frequency: "L-band penetrates regolith, reveals subsurface ice deposits",
            backscatter: { vv: -9.7, vh: -15.9, coherence: 0.78 },
            processes: ["Dust storm dynamics", "Polar ice cap variation", "Subsurface ice migration", "Atmospheric escape"]
        }
    },
    Jupiter: {
        name: "Jupiter", distance: 9, size: 0.8, color: 0xdeb887,
        texturePath: 'textures/jupiter.jpg',
        revolutionPeriod: 4333, rotationPeriod: 0.41,
        sarCapable: false,
        description: "Gas giant - radio emissions and atmospheric dynamics studied through passive radar astronomy."
    },
    Saturn: {
        name: "Saturn", distance: 12, size: 0.7, color: 0xf4e4bc,
        texturePath: 'textures/saturn.jpg',
        revolutionPeriod: 10759, rotationPeriod: 0.45, hasRings: true,
        sarCapable: false,
        description: "Ring system composition analyzed through radio occultation and backscatter studies."
    },
    Uranus: {
        name: "Uranus", distance: 16, size: 0.6, color: 0x00ffff,
        texturePath: 'textures/uranus.jpg',
        revolutionPeriod: 30687, rotationPeriod: 0.72,
        sarCapable: false,
        description: "Ice giant with unique tilted magnetic field studied through radio astronomy."
    },
    Neptune: {
        name: "Neptune", distance: 19, size: 0.58, color: 0x0000ff,
        texturePath: 'textures/neptune.jpg',
        revolutionPeriod: 60190, rotationPeriod: 0.67,
        sarCapable: false,
        description: "Dynamic atmosphere with supersonic winds studied through atmospheric radar."
    }
};

        // Earth-specific SAR analysis data
        const earthProcesses = {
            forest: {
                name: "Amazon Rainforest Analysis",
                backscatter: { vv: -8.5, vh: -15.2, hh: -7.8, hv: -16.1 },
                coherence: 0.75, phase: 1.8,
                hypothesis: "Dense canopy structure creates strong volume scattering in cross-polarized channels. Multi-temporal analysis reveals deforestation patterns and biomass changes over seasonal cycles.",
                processes: ["Photosynthetic cycles", "Deforestation monitoring", "Biomass estimation", "Canopy gap dynamics"]
            },
            flood: {
                name: "Wetland Flood Mapping",
                backscatter: { vv: -22.8, vh: -28.5, hh: -21.9, hv: -27.3 },
                coherence: 0.95, phase: 0.2,
                hypothesis: "Smooth water surfaces create specular reflection with very low backscatter. Emergent vegetation increases cross-pol returns through double-bounce scattering mechanisms.",
                processes: ["Hydrological dynamics", "Wetland ecosystem health", "Storm surge impact", "Sediment transport"]
            },
            volcano: {
                name: "Volcanic Terrain Analysis",
                backscatter: { vv: -6.2, vh: -12.8, hh: -5.9, hv: -13.1 },
                coherence: 0.65, phase: 3.8,
                hypothesis: "Rough volcanic terrain produces high backscatter due to surface scattering. Temporal coherence loss indicates ongoing deformation and cooling processes in active lava flows.",
                processes: ["Magmatic processes", "Ground deformation", "Thermal monitoring", "Hazard assessment"]
            },
            ice: {
                name: "Glacial Ice Dynamics",
                backscatter: { vv: -18.5, vh: -24.2, hh: -17.8, hv: -23.9 },
                coherence: 0.88, phase: 0.9,
                hypothesis: "Ice penetration depth varies with temperature and frequency. Interferometric analysis reveals glacier velocity and mass balance changes driven by climate forcing.",
                processes: ["Ice flow dynamics", "Mass balance changes", "Climate response", "Sea level contribution"]
            }
        };

        function init() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000011);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 15, 25);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('scene-container').appendChild(renderer.domElement);

            // Lighting
            setupLighting();
            
            // Create solar system
            createSun();
            createPlanets();
            createAsteroidBelt();
            createStarField();
            createOrbits();

            // Controls
            setupControls();
            setupEventListeners();

            // Initialize chart
            initializeSARChart();

            // Start animation
            animate();
        }

        function setupLighting() {
            const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
            scene.add(ambientLight);

            const sunLight = new THREE.PointLight(0xffffff, 3, 200, 2);
            sunLight.position.set(0, 0, 0);
            sunLight.castShadow = true;
            scene.add(sunLight);
        }

        function createSun() {
            const geometry = new THREE.SphereGeometry(1, 64, 64);
            const textureLoader = new THREE.TextureLoader();
            
            // Create sun texture programmatically
            const sunTexture = textureLoader.load("textures/sun.jpg");
            
            const material = new THREE.MeshBasicMaterial({ 
                map: sunTexture,
                emissive: 0xffff00,
                emissiveIntensity: 0.6
            });
            const sun = new THREE.Mesh(geometry, material);
            scene.add(sun);

            // Solar corona effect
            const coronaGeometry = new THREE.SphereGeometry(1.3, 64, 64);
            const coronaMaterial = new THREE.MeshBasicMaterial({
                color: 0xffaa00,
                transparent: true,
                opacity: 0,
                side: THREE.BackSide
            });
            const corona = new THREE.Mesh(coronaGeometry, coronaMaterial);
            scene.add(corona);
        }

function createPlanets() {
    const textureLoader = new THREE.TextureLoader();

    Object.values(planetDatabase).forEach((data, index) => {
        const geometry = new THREE.SphereGeometry(data.size, 32, 32);

        let material;
        if (data.texturePath) {
            const texture = textureLoader.load(data.texturePath);
            material = new THREE.MeshPhongMaterial({
                map: texture,
                shininess: 20
            });
        } else {
            material = new THREE.MeshPhongMaterial({
                color: data.color,
                shininess: 20
            });
        }

        const planet = new THREE.Mesh(geometry, material);
        planet.position.set(data.distance, 0, 0);
        planet.userData = {
            ...data,
            revolutionAngle: Math.random() * Math.PI * 2,
            rotationAngle: 0,
            index: index
        };
        planet.castShadow = true;
        planet.receiveShadow = true;
        scene.add(planet);
        planets.push(planet);

        // Add atmosphere for terrestrial planets
        if (['Earth', 'Venus', 'Mars'].includes(data.name)) {
            const atmoGeometry = new THREE.SphereGeometry(data.size * 1.05, 16, 16);
            const atmoColor = data.name === 'Earth' ? 0x87ceeb :
                data.name === 'Venus' ? 0xffd700 : 0xff9999;
            const atmoMaterial = new THREE.MeshBasicMaterial({
                color: atmoColor,
                transparent: true,
                opacity: 0.2,
                side: THREE.BackSide
            });
            const atmosphere = new THREE.Mesh(atmoGeometry, atmoMaterial);
            planet.add(atmosphere);
        }
                // Add Saturn's rings
                if (data.hasRings) {
                    const ringGeometry = new THREE.RingGeometry(data.size * 1.2, data.size * 2.0, 32);
                    const ringMaterial = new THREE.MeshLambertMaterial({
                        color: 0xaaaaaa,
                        transparent: true,
                        opacity: 0.8,
                        side: THREE.DoubleSide
                    });
                    const rings = new THREE.Mesh(ringGeometry, ringMaterial);
                    rings.rotation.x = Math.PI / 2;
                    rings.rotation.z = Math.PI / 12;
                    planet.add(rings);
                }
            });
        }

        function createAsteroidBelt() {
            for (let i = 0; i < 400; i++) {
                const geometry = new THREE.OctahedronGeometry(0.01 + Math.random() * 0.02, 0);
                const material = new THREE.MeshPhongMaterial({ 
                    color: 0x666666 + Math.random() * 0x444444
                });
                const asteroid = new THREE.Mesh(geometry, material);
                
                const angle = Math.random() * Math.PI * 2;
                const distance = 7.5 + Math.random() * 1.0;
                const height = (Math.random() - 0.5) * 0.3;

                asteroid.position.set(
                    Math.cos(angle) * distance,
                    height,
                    Math.sin(angle) * distance
                );
                asteroid.userData = { 
                    angle: angle,
                    distance: distance,
                    rotationSpeed: Math.random() * 0.02
                };
                scene.add(asteroid);
                asteroids.push(asteroid);
            }
        }

        function createStarField() {
            const starsGeometry = new THREE.BufferGeometry();
            const starsCount = 5000;
            const positions = new Float32Array(starsCount * 3);

            for (let i = 0; i < starsCount; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 400;
                positions[i * 3 + 1] = (Math.random() - 0.5) * 400;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 400;
            }

            starsGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const starsMaterial = new THREE.PointsMaterial({ 
                color: 0xffffff,
                size: 1,
                sizeAttenuation: false
            });
            const stars = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(stars);
        }

        function createOrbits() {
            Object.values(planetDatabase).forEach(data => {
                const points = [];
                for (let i = 0; i <= 64; i++) {
                    const angle = (i / 64) * Math.PI * 2;
                    points.push(new THREE.Vector3(
                        Math.cos(angle) * data.distance,
                        0,
                        Math.sin(angle) * data.distance
                    ));
                }
                const geometry = new THREE.BufferGeometry().setFromPoints(points);
                const material = new THREE.LineBasicMaterial({ 
                    color: 0x00ffff,
                    transparent: true,
                    opacity: 0.3
                });
                const orbit = new THREE.Line(geometry, material);
                scene.add(orbit);
                orbits.push(orbit);
            });
        }

        function setupControls() {
            // Mouse interaction for camera
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };

            renderer.domElement.addEventListener('mousedown', (event) => {
                isDragging = true;
                previousMousePosition = { x: event.clientX, y: event.clientY };
            });

            renderer.domElement.addEventListener('mousemove', (event) => {
                if (!isDragging) return;
                
                const deltaMove = {
                    x: event.clientX - previousMousePosition.x,
                    y: event.clientY - previousMousePosition.y
                };

                const spherical = new THREE.Spherical();
                spherical.setFromVector3(camera.position);
                spherical.theta -= deltaMove.x * 0.01;
                spherical.phi += deltaMove.y * 0.01;
                spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));

                camera.position.setFromSpherical(spherical);
                camera.lookAt(0, 0, 0);

                previousMousePosition = { x: event.clientX, y: event.clientY };
            });

            renderer.domElement.addEventListener('mouseup', () => {
                isDragging = false;
            });

            // Mouse wheel zoom
            renderer.domElement.addEventListener('wheel', (event) => {
                const distance = camera.position.length();
                const newDistance = Math.max(5, Math.min(100, distance + event.deltaY * 0.01));
                camera.position.normalize().multiplyScalar(newDistance);
            });

            // Planet clicking
            renderer.domElement.addEventListener('click', handlePlanetClick);
        }

        function handlePlanetClick(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(planets);

            if (intersects.length > 0) {
                const planet = intersects[0].object;
                showPlanetInfo(planet.userData);
                currentPlanet = planet.userData;
            }
        }

        function setupEventListeners() {
            // Speed controls
            document.getElementById('revolution-speed').addEventListener('input', (e) => {
                revolutionSpeed = parseFloat(e.target.value);
                document.getElementById('rev-speed-val').textContent = revolutionSpeed.toFixed(1) + 'x';
                document.getElementById('orbital-speed-display').textContent = revolutionSpeed.toFixed(1) + 'x';
            });

            document.getElementById('rotation-speed').addEventListener('input', (e) => {
                rotationSpeed = parseFloat(e.target.value);
                document.getElementById('rot-speed-val').textContent = rotationSpeed.toFixed(1) + 'x';
            });

            // Animation controls
            document.getElementById('pause-animation').addEventListener('click', () => {
                isPaused = !isPaused;
                const button = document.getElementById('pause-animation');
                if (isPaused) {
                    button.innerHTML = '<span class="material-icons text-base mr-2">play_arrow</span>RESUME SYSTEM';
                } else {
                    button.innerHTML = '<span class="material-icons text-base mr-2">pause</span>PAUSE SYSTEM';
                }
            });

            // View controls
            document.getElementById('reset-view').addEventListener('click', () => {
                camera.position.set(0, 15, 25);
                camera.lookAt(0, 0, 0);
            });

            document.getElementById('toggle-orbits').addEventListener('click', () => {
                orbits.forEach(orbit => orbit.visible = !orbit.visible);
            });

            // SAR controls
            document.getElementById('sar-scan').addEventListener('click', toggleSARScanning);
            document.getElementById('hypothesis-mode').addEventListener('click', showHypothesis);

            // Panel controls
            document.getElementById('close-planet-info').addEventListener('click', () => {
                document.getElementById('planet-info').classList.add('hidden');
                document.getElementById('sar-panel').classList.add('hidden');
                currentPlanet = null;
                document.getElementById('system-mode').textContent = 'SOLAR SYSTEM';
                document.getElementById('active-planet').textContent = 'ALL SYSTEMS';
                document.getElementById('sar-status').textContent = 'STANDBY';
            });

            document.getElementById('activate-sar').addEventListener('click', activateSAR);
            document.getElementById('close-hypothesis').addEventListener('click', () => {
                document.getElementById('hypothesis-panel').classList.add('hidden');
            });

            // Resize handler
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        function showPlanetInfo(planetData) {
            document.getElementById('planet-name').textContent = planetData.name;
            document.getElementById('active-planet').textContent = planetData.name.toUpperCase();
            
            let detailsHTML = `
                <div class="grid grid-cols-2 gap-4 text-xs">
                    <div>
                        <div class="text-cyan-400 font-medium">Orbital Period:</div>
                        <div>${planetData.revolutionPeriod} Earth days</div>
                    </div>
                    <div>
                        <div class="text-green-400 font-medium">Rotation Period:</div>
                        <div>${Math.abs(planetData.rotationPeriod)} ${planetData.rotationPeriod < 0 ? '(retrograde)' : ''} days</div>
                    </div>
                    <div>
                        <div class="text-yellow-400 font-medium">Distance from Sun:</div>
                        <div>${(planetData.distance * 0.1).toFixed(1)} AU</div>
                    </div>
                    <div>
                        <div class="text-purple-400 font-medium">SAR Compatible:</div>
                        <div class="${planetData.sarCapable ? 'text-green-400' : 'text-red-400'}">${planetData.sarCapable ? 'Yes' : 'No'}</div>
                    </div>
                </div>
            `;

            if (planetData.sarCapable) {
                detailsHTML += `
                    <div class="mt-4 p-3 bg-green-900 bg-opacity-30 rounded border-l-2 border-green-400">
                        <div class="text-green-400 font-medium text-sm mb-2">SAR Analysis Capability:</div>
                        <div class="text-xs">${planetData.sarData.description}</div>
                        <div class="text-xs mt-2 text-cyan-300">Optimal: ${planetData.sarData.frequency}</div>
                    </div>
                `;
            }

            document.getElementById('planet-details').innerHTML = detailsHTML;
            document.getElementById('planet-info').classList.remove('hidden');
        }

        function activateSAR() {
            if (!currentPlanet || !currentPlanet.sarCapable) return;
            
            document.getElementById('planet-info').classList.add('hidden');
            document.getElementById('sar-panel').classList.remove('hidden');
            document.getElementById('system-mode').textContent = 'SAR ANALYSIS';
            document.getElementById('sar-status').textContent = 'ACTIVE';

            // Show Earth-specific processes if analyzing Earth
            if (currentPlanet.name === 'Earth') {
                document.getElementById('earth-processes').classList.remove('hidden');
            } else {
                document.getElementById('earth-processes').classList.add('hidden');
            }

            updateSARDisplay();
        }

        function updateSARDisplay() {
            if (!currentPlanet || !currentPlanet.sarCapable) return;

            const sarData = currentPlanet.sarData;
            const timestamp = new Date().toISOString().substr(11, 8);
            
            const displayData = `SAR ANALYSIS [${timestamp}] - ${currentPlanet.name.toUpperCase()}:

BACKSCATTER COEFFICIENTS:
œÉ¬∞VV: ${sarData.backscatter.vv} dB
œÉ¬∞VH: ${sarData.backscatter.vh} dB  
Coherence: ${sarData.backscatter.coherence}

RADAR CONFIGURATION:
${sarData.frequency}
Penetration: ${currentPlanet.name === 'Venus' ? 'Atmospheric' : 'Surface/Subsurface'}

PHYSICAL PROCESSES DETECTED:
${sarData.processes.map(p => `‚Ä¢ ${p}`).join('\n')}

TARGET CHARACTERISTICS:
Surface roughness: ${Math.random() > 0.5 ? 'High' : 'Moderate'}
Dielectric properties: Variable
Temporal stability: ${sarData.backscatter.coherence > 0.8 ? 'Stable' : 'Dynamic'}`;

            document.getElementById('sar-data').textContent = displayData;
        }

        function toggleSARScanning() {
            if (!currentPlanet) return;
            
            isScanning = !isScanning;
            const button = document.getElementById('sar-scan');
            
            if (isScanning) {
                button.innerHTML = '<span class="material-icons text-base mr-2">stop</span>TERMINATE SCAN';
                button.classList.replace('bg-green-600', 'bg-red-600');
            } else {
                button.innerHTML = '<span class="material-icons text-base mr-2">play_arrow</span>INITIATE SAR SCAN';
                button.classList.replace('bg-red-600', 'bg-green-600');
            }
        }

function createSARBeam(planet) {
    // Beam geometry & material
    const beamGeometry = new THREE.ConeGeometry(0.36, 9, 32, 1, true);
    const beamMaterial = new THREE.MeshBasicMaterial({
        color: 0x00ffaa,
        transparent: true,
        opacity: 0.6,
        side: THREE.DoubleSide,
    });

    // Gradient vertex colors
    const colors = [];
    const colorTop = new THREE.Color(0x00ffaa);
    const colorBottom = new THREE.Color(0x001a0d);
    const pos = beamGeometry.attributes.position;
    for (let i = 0; i < pos.count; i++) {
        const y = pos.getY(i);
        const lerp = (y + 6) / 12;
        const color = colorTop.clone().lerp(colorBottom, lerp);
        colors.push(color.r, color.g, color.b);
    }
    beamGeometry.setAttribute("color", new THREE.Float32BufferAttribute(colors, 3));
    beamMaterial.vertexColors = true;

    const beam = new THREE.Mesh(beamGeometry, beamMaterial);

    // Glow
    const glowGeometry = new THREE.ConeGeometry(0.6, 10, 28, 1, true);
    const glowMaterial = new THREE.MeshBasicMaterial({
        color: 0x00ffaa,
        transparent: true,
        opacity: 0.15,
        side: THREE.DoubleSide,
    });
    const glow = new THREE.Mesh(glowGeometry, glowMaterial);
    beam.add(glow);

    // Position beam
    const direction = planet.position.clone().normalize();
    beam.position.copy(direction.multiplyScalar(planet.position.length() + 3));
    beam.lookAt(planet.position);

    scene.add(beam);
    sarBeams.push(beam);

    // Pulse animation
    const pulse = { scale: 1 };
    const pulseTween = gsap.to(pulse, {
        scale: 1.2,
        duration: 0.8,
        yoyo: true,
        repeat: -1,
        onUpdate: () => {
            beam.scale.set(pulse.scale, 1, pulse.scale);
        }
    });

    // Fade-out & remove after 3s
    setTimeout(() => {
        // Stop pulse
        pulseTween.kill();

        // Shrink + fade beam
        gsap.to(beam.scale, { x: 0, y: 0, z: 0, duration: 1.2 });
        gsap.to(beam.material, {
            opacity: 0,
            duration: 1.2,
            onUpdate: () => { beam.material.needsUpdate = true; },
            onComplete: () => {
                // Remove glow children
                beam.children.forEach(child => {
                    if (child.material) child.material.dispose();
                    if (child.geometry) child.geometry.dispose();
                });

                // Remove beam
                scene.remove(beam);

                // Dispose geometry & material
                if (beam.material) beam.material.dispose();
                if (beam.geometry) beam.geometry.dispose();

                // Remove from array
                const index = sarBeams.indexOf(beam);
                if (index > -1) sarBeams.splice(index, 1);
            }
        });

        // Fade glow
        beam.children.forEach(child => {
            if (child.material) {
                gsap.to(child.material, { opacity: 0, duration: 1.2, onUpdate: () => { child.material.needsUpdate = true; } });
            }
        });
    }, 3000);
}


        

        function showHypothesis() {
            let content = '';
            
            if (currentPlanet && currentPlanet.name === 'Earth') {
                content = `
                    <p class="mb-3 text-pink-300 font-medium">Earth System Analysis Hypothesis:</p>
                    <p class="mb-3">Multi-frequency SAR observations reveal complex interactions between Earth's surface, atmosphere, and biosphere. The radar signatures indicate:</p>
                    <ul class="list-disc list-inside space-y-1 text-xs mb-4">
                        <li>Surface roughness variations correlate with geological and biological processes</li>
                        <li>Temporal coherence changes indicate dynamic surface modifications</li>
                        <li>Polarimetric signatures reveal different scattering mechanisms in various environments</li>
                        <li>Multi-band analysis enables process separation and physical interpretation</li>
                    </ul>
                    <div class="p-3 bg-purple-900 bg-opacity-50 rounded">
                        <strong class="text-cyan-400">Research Methodology:</strong> Through the Radar Looking Glass approach using Sentinel-1, ALOS-PALSAR, and TerraSAR missions for comprehensive Earth process understanding.
                    </div>
                `;
            } else if (currentPlanet && currentPlanet.sarCapable) {
                content = `
                    <p class="mb-3 text-pink-300 font-medium">Planetary SAR Analysis Hypothesis for ${currentPlanet.name}:</p>
                    <p class="mb-3">${currentPlanet.sarData.description}</p>
                    <div class="text-xs space-y-2">
                        <div><strong class="text-cyan-400">Optimal Configuration:</strong> ${currentPlanet.sarData.frequency}</div>
                        <div><strong class="text-yellow-400">Key Processes:</strong></div>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            ${currentPlanet.sarData.processes.map(p => `<li>${p}</li>`).join('')}
                        </ul>
                    </div>
                `;
            } else {
                content = `
                    <p class="mb-3 text-pink-300 font-medium">Solar System SAR Exploration:</p>
                    <p class="mb-3">Select a SAR-compatible planet (Mercury, Venus, Earth, or Mars) to generate specific scientific hypotheses about observable processes through synthetic aperture radar analysis.</p>
                `;
            }

            document.getElementById('hypothesis-content').innerHTML = content;
            document.getElementById('hypothesis-panel').classList.remove('hidden');
        }

        function analyzeProcess(processType) {
            if (!earthProcesses[processType]) return;
            
            const process = earthProcesses[processType];
            currentProcess = processType;
            
            document.getElementById('sar-data').textContent = `EARTH PROCESS ANALYSIS - ${process.name.toUpperCase()}:

BACKSCATTER ANALYSIS:
œÉ¬∞VV: ${process.backscatter.vv} dB
œÉ¬∞VH: ${process.backscatter.vh} dB
œÉ¬∞HH: ${process.backscatter.hh} dB  
œÉ¬∞HV: ${process.backscatter.hv} dB

COHERENCE: ${process.coherence}
PHASE: ${process.phase} radians

PHYSICAL HYPOTHESIS:
${process.hypothesis}

KEY PROCESSES:
${process.processes.map(p => `‚Ä¢ ${p}`).join('\n')}

STATUS: Active monitoring enabled`;
        }

        window.focusPlanet = function(planetName) {
            const planet = planets.find(p => p.userData.name === planetName);
            if (planet) {
                currentPlanet = planet.userData;
                showPlanetInfo(planet.userData);
                
                // Focus camera on planet
                const planetPos = planet.position.clone();
                const distance = 8;
                camera.position.copy(planetPos.clone().normalize().multiplyScalar(distance));
                camera.lookAt(planetPos);
            }
        };

        window.focusPlanetCamera = function() {
            if (currentPlanet) {
                const planet = planets.find(p => p.userData.name === currentPlanet.name);
                if (planet) {
                    const planetPos = planet.position.clone();
                    const distance = currentPlanet.size * 8;
                    camera.position.copy(planetPos.clone().add(new THREE.Vector3(distance, distance * 0.5, distance)));
                    camera.lookAt(planetPos);
                }
            }
        };

        window.analyzeProcess = analyzeProcess;

        function initializeSARChart() {
            const ctx = document.getElementById('temporal-chart').getContext('2d');
            sarChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['T-5', 'T-4', 'T-3', 'T-2', 'T-1', 'T0'],
                    datasets: [{
                        label: 'Backscatter',
                        data: [-12, -14, -11, -15, -13, -12],
                        borderColor: '#00ff7f',
                        backgroundColor: 'rgba(0, 255, 127, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#cccccc', font: { size: 9 } },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: {
                            ticks: { color: '#00ff7f', font: { size: 9 } },
                            grid: { color: 'rgba(0,255,127,0.2)' }
                        }
                    }
                }
            });
        }

        function updateSystem() {
            if (isPaused) return;
            
            const deltaTime = clock.getDelta();
            
            // Update planets
            planets.forEach(planet => {
                const data = planet.userData;
                
                // Revolution around sun
                const revolutionRate = (2 * Math.PI) / (data.revolutionPeriod * 0.1);
                data.revolutionAngle += revolutionRate * deltaTime * revolutionSpeed;
                
                planet.position.set(
                    Math.cos(data.revolutionAngle) * data.distance,
                    0,
                    Math.sin(data.revolutionAngle) * data.distance
                );
                
                // Rotation
                const rotationRate = (2 * Math.PI) / (Math.abs(data.rotationPeriod) * 0.05);
                const rotationDirection = data.rotationPeriod < 0 ? -1 : 1;
                data.rotationAngle += rotationRate * deltaTime * rotationSpeed * rotationDirection;
                planet.rotation.y = data.rotationAngle;
                
                // Create SAR beams if scanning this planet
                if (isScanning && currentPlanet && data.name === currentPlanet.name && Math.random() < 0.005) {
                    createSARBeam(planet);
                }
            });
            
            // Update asteroids
            asteroids.forEach(asteroid => {
                asteroid.rotation.x += asteroid.userData.rotationSpeed * rotationSpeed;
                asteroid.rotation.y += asteroid.userData.rotationSpeed * rotationSpeed;
                
                asteroid.userData.angle += 0.0001 * revolutionSpeed;
                asteroid.position.set(
                    Math.cos(asteroid.userData.angle) * asteroid.userData.distance,
                    asteroid.position.y,
                    Math.sin(asteroid.userData.angle) * asteroid.userData.distance
                );
            });
            
            // Update SAR data if active
            if (currentPlanet && Math.random() < 0.1) {
                updateSARDisplay();
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            updateSystem();
            renderer.render(scene, camera);
        }

        // Initialize system
        init();
        
        console.log('üõ∞Ô∏è CosmoRudder Solar System SAR Navigator Initialized');
        console.log('üåç Combined solar system exploration with Earth SAR process analysis');
        console.log('üì° Click planets to activate SAR analysis capabilities');
        console.log('üî¨ Earth features advanced process-specific SAR analysis');
    </script>
</body>
</html>